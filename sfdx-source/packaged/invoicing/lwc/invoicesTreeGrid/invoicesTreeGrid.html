<template>

    <lightning-card>
        
        <lightning-button slot="actions" label="Commit Updates" variant="brand" onclick={updateDirtyInvoices}></lightning-button>
        
        <div class="slds-p-horizontal_medium slds-is-relative">
            <table class="invoice-table slds-table slds-table_bordered slds-border_left slds-border_right">
                <thead>
                    <tr>
                        <th scope="col">Invoice Number</th>
                        <th scope="col">Account Name</th>
                        <th scope="col">Invoice Date</th>
                        <th scope="col">Service Period Start</th>
                        <th scope="col">Service Period End</th>
                        <th scope="col">Total Amount (Net)</th>
                        <th scope="col">Total Amount (Gross)</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={invoiceData} for:item='invoice'>
                        <!-- The invoice record itself -->
                        <c-invoices-tree-grid-item rowdata={invoice} key={invoice.Record.Id} onrecordchange={cacheUpdatedRecord}></c-invoices-tree-grid-item>
                        
                        <!-- Table of line items, if this invoice has any -->
                        <template if:true={invoice.hasLineItems}>
                            <tr key={invoice.Record.Id}>
                                <td colspan="8" class="lineitem-table-cell">
                                    <c-invoice-line-item-datatable lineitems={invoice.LineItems}></c-invoice-line-item-datatable>
                                </td>
                            </tr>
                        </template>

                    </template>
                </tbody>
            </table>
            <template if:true={isWorking}>
                <lightning-spinner alternative-text="Crunching Numbers ..." size="large"></lightning-spinner>
            </template>
        </div>
    </lightning-card>

</template>